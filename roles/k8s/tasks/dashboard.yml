---

- name: Add kubernetes-dashboard repo
  kubernetes.core.helm_repository:
    name: kubernetes-dashboard
    repo_url: https://kubernetes.github.io/dashboard/

- name: Deploy kubernetes-dashboard
  kubernetes.core.helm:
    name: kubernetes-dashboard
    release_namespace: kubernetes-dashboard
    chart_ref: kubernetes-dashboard/kubernetes-dashboard
    create_namespace: true

- name: Copy configs
  ansible.builtin.copy:
    src: "{{ item }}"
    dest: "/var/opt/k8s/{{ item }}"
    owner: root
    mode: "0644"
  loop:
    - dashboard.adminuser.yml

- name: Apply adminuser values to the cluster.
  kubernetes.core.k8s:
    state: present
    src: "/var/opt/k8s/{{ item }}"
  loop:
    - dashboard.adminuser.yml

- name: Create token
  ansible.builtin.command: >
    kubectl -n kubernetes-dashboard create token admin-user
  register: create_token
  changed_when: create_token.rc == 0

...
